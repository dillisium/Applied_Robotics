{"version":3,"sources":["webpack:///./src/components/CameraView/VideoProjectionStream.vue","webpack:///./src/components/CameraView/videoProjector.ts","webpack:///./src/components/CameraView/VideoProjectionStream.vue?de0f","webpack:///./src/components/CameraView/VideoProjectionStream.vue?1312","webpack:///./src/components/CameraView/VideoProjectionStream.vue?c0e1","webpack:///./node_modules/core-js/modules/es.typed-array.int32-array.js","webpack:///./node_modules/core-js/internals/whitespaces.js","webpack:///./node_modules/core-js/internals/string-trim.js","webpack:///./src/components/CameraView/VideoStream.vue?a907","webpack:///./node_modules/core-js/internals/create-html.js","webpack:///./node_modules/core-js/modules/es.string.link.js","webpack:///./node_modules/core-js/modules/es.array.splice.js","webpack:///./node_modules/core-js/modules/es.number.constructor.js","webpack:///./node_modules/core-js/internals/string-html-forced.js","webpack:///./src/components/CameraView/VideoStream.vue","webpack:///./src/components/CameraView/VideoStream.vue?098a","webpack:///./src/components/CameraView/VideoStream.vue?3a30","webpack:///./src/plugins/decoder/decoder.worker.js","webpack:///./src/plugins/decoder/decoder.js","webpack:///./node_modules/core-js/modules/es.array.find-index.js","webpack:///./node_modules/core-js/modules/es.typed-array.float32-array.js","webpack:///../src/ShaderProgram.ts","webpack:///../src/ShaderCompiler.ts","webpack:///../src/ShaderSources.ts","webpack:///../src/YUVSurfaceShader.ts","webpack:///../src/Texture.ts","webpack:///../src/YuvCanvas.ts"],"names":["class","ref","loadingScreen","this","element","loadingUIBackgroundColor","loadingUIText","style","display","canvas","fov","width","height","opacity","textureWidth","textureHeight","nodeName","engine","preserveDrawingBuffer","stencil","enableOfflineSupport","displayLoadingUI","scene","clearColor","pointerEvents","pointerDistance","pointerFov","camera","Math","PI","fovMode","FOVMODE_HORIZONTAL_FIXED","alpha","beta","dynamicTexture","ctx","getContext","Append","hideLoadingUI","mapMesh","getNodeByName","mapMaterial","material","albedoTexture","update","onpointerdown","evt","length","push","sqrt","clientX","clientY","onpointermove","index","findIndex","storedEvt","pointerId","otherPointerEvt","newPointerDistance","nextFov","criticalAngle","movementX","movementY","dx","clientWidth","dy","alphaNext","betaNext","angle","pointerEnd","splice","onpointerup","onpointercancel","onpointerout","addEventListener","deltaY","runRenderLoop","render","sx","sy","ex","ey","drawImage","name","props","wsAddress","type","String","required","Number","size","offset","setup","yuv","wsConnection","decoder","reconnectId","yuvCanvas","babylonCanvas","videoProjector","timeFrame","Date","getTime","msgCount","startRendering","value","connectServer","address","close","WebSocket","binaryType","onmessage","data","byteLength","decode","buffer","then","frame","drawFrame","renderImage","catch","stopRendering","stopRenderLoop","dispose","window","setInterval","now","readyState","countArray","Int32Array","send","clearInterval","terminate","__scopeId","createTypedArrayConstructor","init","byteOffset","module","exports","requireObjectCoercible","whitespaces","whitespace","ltrim","RegExp","rtrim","createMethod","TYPE","$this","string","replace","start","end","trim","quot","tag","attribute","S","p1","$","createHTML","forcedStringHTMLMethod","target","proto","forced","link","url","toAbsoluteIndex","toInteger","toLength","toObject","arraySpeciesCreate","createProperty","arrayMethodHasSpeciesSupport","arrayMethodUsesToLength","HAS_SPECIES_SUPPORT","USES_TO_LENGTH","ACCESSORS","0","1","max","min","MAX_SAFE_INTEGER","MAXIMUM_ALLOWED_LENGTH_EXCEEDED","deleteCount","insertCount","actualDeleteCount","A","k","from","to","O","len","actualStart","argumentsLength","arguments","TypeError","DESCRIPTORS","global","isForced","redefine","has","classof","inheritIfRequired","toPrimitive","fails","create","getOwnPropertyNames","f","getOwnPropertyDescriptor","defineProperty","NUMBER","NativeNumber","NumberPrototype","prototype","BROKEN_CLASSOF","toNumber","argument","first","third","radix","maxCode","digits","code","it","charCodeAt","NaN","slice","parseInt","key","NumberWrapper","dummy","valueOf","call","keys","split","j","constructor","METHOD_NAME","test","toLowerCase","Worker_fn","Worker","Decoder","renderStateId","worker","workerReady","decodeBuffer","codec","e","message","shift","resolve","reject","postMessage","Promise","$findIndex","addToUnscopables","FIND_INDEX","SKIPS_HOLES","Array","callbackfn","undefined","shader","script","gl","createShader","FRAGMENT_SHADER","vertexQuad","source","fragmentYUV","TEXTURE_2D"],"mappings":"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","file":"js/chunk-aec47eca.a021e232.js","sourcesContent":["<template>\n  <div class=\"canvasContainer\">\n    <div ref=\"loadingScreen\" class=\"videoLoadingScreen\"></div>\n    <canvas ref=\"babylonCanvas\"></canvas>\n    <canvas ref=\"yuvCanvas\"></canvas>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  defineComponent,\n  watchEffect\n} from \"vue\";\nimport { YuvCanvas } from \"webglUtils\";\nimport { VideoProjector } from \"@/components/CameraView/videoProjector\";\nimport { Decoder } from \"@/plugins/decoder/decoder\";\n\nexport default defineComponent({\n  name: \"VideoProjectionStream\",\n  props: {\n    wsAddress: {\n      type: String,\n      required: true\n    },\n    fov: {\n      type: Number,\n      required: true\n    },\n    size: {\n      type: Number,\n      required: true\n    },\n    offset: {\n      type: Number,\n      required: true\n    }\n  },\n  setup(props) {\n    const yuvCanvas = ref(null as null | HTMLCanvasElement);\n    const babylonCanvas = ref(null as null | HTMLCanvasElement);\n    const loadingScreen = ref(null as null | HTMLDivElement);\n\n    let yuv: undefined | YuvCanvas;\n    let videoProjector: null | VideoProjector = null;\n    let wsConnection: null | WebSocket;\n    let decoder: null | Decoder;\n    let reconnectId: number;\n    let timeFrame = new Date().getTime();\n    let msgCount = 0;\n    const startRendering = () => {\n      if (!babylonCanvas.value) return;\n      if (!loadingScreen.value) return;\n      videoProjector = new VideoProjector(\n        babylonCanvas.value,\n        loadingScreen.value,\n        props.fov,\n        props.size,\n        props.size\n      );\n      videoProjector.startRendering();\n    };\n    const connectServer = (address: string) => {\n      if (wsConnection) {\n        wsConnection.close();\n        wsConnection = null;\n      }\n      wsConnection = new WebSocket(address);\n      wsConnection.binaryType = \"arraybuffer\";\n      wsConnection.onmessage = (evt: MessageEvent) => {\n        msgCount++;\n        if (evt.data.byteLength) {\n          decoder\n            ?.decode({ buffer: evt.data, offset: 0 })\n            .then(frame => {\n              timeFrame = new Date().getTime();\n              if (yuv) yuv.drawFrame(frame);\n              if (yuvCanvas.value && videoProjector) {\n                videoProjector.renderImage(\n                  yuvCanvas.value,\n                  props.offset,\n                  0,\n                  props.offset + props.size,\n                  props.size\n                );\n              }\n            })\n            .catch(() => {\n              // do nothing\n            });\n        }\n      };\n    };\n\n    const stopRendering = () => {\n      if (videoProjector) {\n        videoProjector.engine.stopRenderLoop();\n        videoProjector.engine.dispose();\n      }\n    };\n\n    watchEffect(() => {\n      connectServer(props.wsAddress);\n    });\n    onMounted(() => {\n      if (!yuvCanvas.value) return;\n      if (!babylonCanvas.value) return;\n      yuv = new YuvCanvas(yuvCanvas.value);\n      decoder = new Decoder();\n      startRendering();\n      connectServer(props.wsAddress);\n      reconnectId = window.setInterval(() => {\n        const now = new Date().getTime();\n        if (now - timeFrame > 5000) {\n          timeFrame = now;\n          connectServer(props.wsAddress);\n        } else {\n          if (wsConnection && wsConnection.readyState === 1) {\n            const countArray = new Int32Array(1);\n            countArray[0] = msgCount;\n            wsConnection.send(countArray.buffer);\n          }\n        }\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      stopRendering();\n      window.clearInterval(reconnectId);\n      wsConnection?.close();\n      decoder?.terminate();\n    });\n    return { yuvCanvas, babylonCanvas, loadingScreen };\n  }\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.videoLoadingScreen {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  background-color: none;\n}\n\ncanvas {\n  height: 100%;\n  width: 100%;\n  transition: opacity 1s;\n  opacity: 0;\n  &.hiddenCanvas {\n    position: absolute;\n    left: 0;\n    top: 0px;\n    z-index: -1;\n  }\n}\n.canvasContainer {\n  height: 100%;\n  width: 100%;\n  background-color: transparent;\n  padding: 0;\n  line-height: 0;\n}\n</style>\n","import * as BABYLON from \"@babylonjs/core\";\nimport \"@babylonjs/loaders\";\n\nclass VideoLoadingScreen implements BABYLON.ILoadingScreen {\n  element: HTMLElement;\n  loadingUIBackgroundColor: string;\n  loadingUIText: string;\n  constructor(loadingScreen: HTMLDivElement) {\n    this.element = loadingScreen;\n    this.loadingUIBackgroundColor = \"\";\n    this.loadingUIText = \"\";\n  }\n  displayLoadingUI() {\n    this.element.style.display = \"flex\";\n  }\n  hideLoadingUI() {\n    this.element.style.display = \"none\";\n  }\n}\n\nexport class VideoProjector {\n  engine: BABYLON.Engine;\n  scene: BABYLON.Scene;\n  ctx: CanvasRenderingContext2D;\n  dynamicTexture: BABYLON.DynamicTexture;\n  textureWidth: number;\n  textureHeight: number;\n  canvas: HTMLCanvasElement;\n  camera: BABYLON.ArcRotateCamera;\n  pointerEvents: PointerEvent[];\n  pointerDistance: number;\n  pointerFov: number;\n  alpha: number;\n  beta: number;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    loadingScreen: HTMLDivElement,\n    fov: number,\n    width: number,\n    height: number\n  ) {\n    this.canvas = canvas;\n    this.canvas.style.opacity = \"0\";\n\n    this.textureWidth = width;\n    this.textureHeight = height;\n    if (canvas === null) throw \"canvas not found\";\n    if (canvas.nodeName !== \"CANVAS\") throw \"not HTMLCanvasElement\";\n    this.engine = new BABYLON.Engine(canvas, true, {\n      preserveDrawingBuffer: true,\n      stencil: true\n    });\n    this.engine.enableOfflineSupport = false;\n    this.engine.loadingScreen = new VideoLoadingScreen(loadingScreen);\n    this.engine.displayLoadingUI();\n    this.scene = new BABYLON.Scene(this.engine);\n    this.scene.clearColor = new BABYLON.Color4(0, 0, 0, 1);\n    this.pointerEvents = [];\n    this.pointerDistance = 0;\n    this.pointerFov = 0;\n\n    const camera = new BABYLON.ArcRotateCamera(\n      \"camera\",\n      Math.PI * 0,\n      Math.PI * 0.5,\n      0.01,\n      new BABYLON.Vector3(0, 0, 0),\n      this.scene\n    );\n    camera.fov = fov;\n    camera.fovMode = BABYLON.Camera.FOVMODE_HORIZONTAL_FIXED;\n    this.camera = camera;\n    this.alpha = 0;\n    this.beta = 0;\n\n    this.dynamicTexture = new BABYLON.DynamicTexture(\n      \"dynamic\",\n      { width: width, height: height },\n      this.scene,\n      false\n    );\n\n    this.ctx = this.dynamicTexture.getContext();\n    BABYLON.SceneLoader.Append(\"/scenes/\", \"projector.glb\", this.scene, () => {\n      this.engine.hideLoadingUI();\n      const mapMesh = this.scene.getNodeByName(\"Mapping\") as BABYLON.Mesh;\n      const mapMaterial = mapMesh.material as BABYLON.PBRMaterial;\n      this.ctx = this.dynamicTexture.getContext();\n      mapMaterial.albedoTexture = this.dynamicTexture;\n      this.dynamicTexture.update();\n    });\n    this.canvas.onpointerdown = (evt: PointerEvent) => {\n      if (this.pointerEvents.length < 2) {\n        this.pointerEvents.push(evt);\n        if (this.pointerEvents.length === 2) {\n          this.pointerDistance = Math.sqrt(\n            (this.pointerEvents[0].clientX - this.pointerEvents[1].clientX) **\n              2 +\n              (this.pointerEvents[0].clientY - this.pointerEvents[1].clientY) **\n                2\n          );\n          this.pointerFov = this.camera.fov;\n        }\n      }\n    };\n    this.canvas.onpointermove = (evt: PointerEvent) => {\n      const index = this.pointerEvents.findIndex(\n        storedEvt => storedEvt.pointerId === evt.pointerId\n      );\n      if (index < 0) return;\n      if (this.pointerEvents.length === 2) {\n        const otherPointerEvt = this.pointerEvents[1 - index];\n        const newPointerDistance = Math.sqrt(\n          (otherPointerEvt.clientX - evt.clientX) ** 2 +\n            (otherPointerEvt.clientY - evt.clientY) ** 2\n        );\n        let nextFov =\n          Math.sqrt(this.pointerDistance / newPointerDistance) *\n          this.pointerFov;\n        if (nextFov > 2.5) nextFov = 2.5;\n        else if (nextFov < 0.25) nextFov = 0.25;\n        const angle = Math.sqrt(this.alpha ** 2 + this.beta ** 2);\n        const criticalAngle = Math.PI / 2 - nextFov / 1.8;\n        this.camera.fov = nextFov;\n        if (angle > criticalAngle) {\n          this.alpha = (this.alpha * criticalAngle) / angle;\n          this.beta = (this.beta * criticalAngle) / angle;\n        }\n      }\n      const movementX = evt.clientX - this.pointerEvents[index].clientX;\n      const movementY = evt.clientY - this.pointerEvents[index].clientY;\n      const dx =\n        ((movementX / this.canvas.clientWidth) * this.camera.fov) /\n        this.pointerEvents.length;\n      const dy =\n        ((movementY / this.canvas.clientWidth) * this.camera.fov) /\n        this.pointerEvents.length;\n      const alphaNext = this.alpha + dx;\n      const betaNext = this.beta + dy;\n      const angle = Math.sqrt(alphaNext ** 2 + betaNext ** 2);\n      if (angle + this.camera.fov / 1.8 < Math.PI / 2) {\n        this.alpha = alphaNext;\n        this.beta = betaNext;\n      } else {\n        if (dx * this.alpha < 0) {\n          this.alpha = alphaNext;\n        }\n        if (dy * this.beta < 0) {\n          this.beta = betaNext;\n        }\n      }\n\n      this.pointerEvents[index] = evt;\n    };\n\n    const pointerEnd = (evt: PointerEvent) => {\n      const index = this.pointerEvents.findIndex(\n        storedEvt => storedEvt.pointerId === evt.pointerId\n      );\n      if (index >= 0) this.pointerEvents.splice(index, 1);\n    };\n    this.canvas.onpointerup = pointerEnd;\n    this.canvas.onpointercancel = pointerEnd;\n    this.canvas.onpointerout = pointerEnd;\n\n    this.canvas.addEventListener(\n      \"wheel\",\n      (evt: MouseWheelEvent) => {\n        let nextFov = 1.0005 ** evt.deltaY * this.camera.fov;\n        if (nextFov > 2.5) nextFov = 2.5;\n        else if (nextFov < 0.25) nextFov = 0.25;\n        const angle = Math.sqrt(this.alpha ** 2 + this.beta ** 2);\n        const criticalAngle = Math.PI / 2 - nextFov / 1.8;\n        this.camera.fov = nextFov;\n        if (angle > criticalAngle) {\n          this.alpha = (this.alpha * criticalAngle) / angle;\n          this.beta = (this.beta * criticalAngle) / angle;\n        }\n        return false;\n      },\n      false\n    );\n  }\n\n  startRendering() {\n    this.engine.runRenderLoop(() => {\n      this.camera.alpha =\n        this.camera.alpha + (this.alpha - this.camera.alpha) / 5;\n      this.camera.beta =\n        this.camera.beta + (this.beta + Math.PI / 2 - this.camera.beta) / 5;\n\n      this.scene.render();\n    });\n  }\n  renderImage(\n    canvas: HTMLCanvasElement,\n    sx: number,\n    sy: number,\n    ex: number,\n    ey: number\n  ) {\n    this.canvas.style.opacity = \"1\";\n    this.ctx.drawImage(\n      canvas,\n      sx,\n      sy,\n      ex,\n      ey,\n      0,\n      0,\n      this.textureWidth,\n      this.textureHeight\n    );\n    this.dynamicTexture.update();\n  }\n}\n","\nimport {\n  onMounted,\n  onBeforeUnmount,\n  ref,\n  defineComponent,\n  watchEffect\n} from \"vue\";\nimport { YuvCanvas } from \"webglUtils\";\nimport { VideoProjector } from \"@/components/CameraView/videoProjector\";\nimport { Decoder } from \"@/plugins/decoder/decoder\";\n\nexport default defineComponent({\n  name: \"VideoProjectionStream\",\n  props: {\n    wsAddress: {\n      type: String,\n      required: true\n    },\n    fov: {\n      type: Number,\n      required: true\n    },\n    size: {\n      type: Number,\n      required: true\n    },\n    offset: {\n      type: Number,\n      required: true\n    }\n  },\n  setup(props) {\n    const yuvCanvas = ref(null as null | HTMLCanvasElement);\n    const babylonCanvas = ref(null as null | HTMLCanvasElement);\n    const loadingScreen = ref(null as null | HTMLDivElement);\n\n    let yuv: undefined | YuvCanvas;\n    let videoProjector: null | VideoProjector = null;\n    let wsConnection: null | WebSocket;\n    let decoder: null | Decoder;\n    let reconnectId: number;\n    let timeFrame = new Date().getTime();\n    let msgCount = 0;\n    const startRendering = () => {\n      if (!babylonCanvas.value) return;\n      if (!loadingScreen.value) return;\n      videoProjector = new VideoProjector(\n        babylonCanvas.value,\n        loadingScreen.value,\n        props.fov,\n        props.size,\n        props.size\n      );\n      videoProjector.startRendering();\n    };\n    const connectServer = (address: string) => {\n      if (wsConnection) {\n        wsConnection.close();\n        wsConnection = null;\n      }\n      wsConnection = new WebSocket(address);\n      wsConnection.binaryType = \"arraybuffer\";\n      wsConnection.onmessage = (evt: MessageEvent) => {\n        msgCount++;\n        if (evt.data.byteLength) {\n          decoder\n            ?.decode({ buffer: evt.data, offset: 0 })\n            .then(frame => {\n              timeFrame = new Date().getTime();\n              if (yuv) yuv.drawFrame(frame);\n              if (yuvCanvas.value && videoProjector) {\n                videoProjector.renderImage(\n                  yuvCanvas.value,\n                  props.offset,\n                  0,\n                  props.offset + props.size,\n                  props.size\n                );\n              }\n            })\n            .catch(() => {\n              // do nothing\n            });\n        }\n      };\n    };\n\n    const stopRendering = () => {\n      if (videoProjector) {\n        videoProjector.engine.stopRenderLoop();\n        videoProjector.engine.dispose();\n      }\n    };\n\n    watchEffect(() => {\n      connectServer(props.wsAddress);\n    });\n    onMounted(() => {\n      if (!yuvCanvas.value) return;\n      if (!babylonCanvas.value) return;\n      yuv = new YuvCanvas(yuvCanvas.value);\n      decoder = new Decoder();\n      startRendering();\n      connectServer(props.wsAddress);\n      reconnectId = window.setInterval(() => {\n        const now = new Date().getTime();\n        if (now - timeFrame > 5000) {\n          timeFrame = now;\n          connectServer(props.wsAddress);\n        } else {\n          if (wsConnection && wsConnection.readyState === 1) {\n            const countArray = new Int32Array(1);\n            countArray[0] = msgCount;\n            wsConnection.send(countArray.buffer);\n          }\n        }\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      stopRendering();\n      window.clearInterval(reconnectId);\n      wsConnection?.close();\n      decoder?.terminate();\n    });\n    return { yuvCanvas, babylonCanvas, loadingScreen };\n  }\n});\n","import { render } from \"./VideoProjectionStream.vue?vue&type=template&id=575a3a00&scoped=true\"\nimport script from \"./VideoProjectionStream.vue?vue&type=script&lang=ts\"\nexport * from \"./VideoProjectionStream.vue?vue&type=script&lang=ts\"\n\nimport \"./VideoProjectionStream.vue?vue&type=style&index=0&id=575a3a00&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-575a3a00\"\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./VideoProjectionStream.vue?vue&type=style&index=0&id=575a3a00&lang=scss&scoped=true\"","var createTypedArrayConstructor = require('../internals/typed-array-constructor');\n\n// `Int32Array` constructor\n// https://tc39.github.io/ecma262/#sec-typedarray-objects\ncreateTypedArrayConstructor('Int32', function (init) {\n  return function Int32Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n","// a string of all valid unicode whitespaces\n// eslint-disable-next-line max-len\nmodule.exports = '\\u0009\\u000A\\u000B\\u000C\\u000D\\u0020\\u00A0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF';\n","var requireObjectCoercible = require('../internals/require-object-coercible');\nvar whitespaces = require('../internals/whitespaces');\n\nvar whitespace = '[' + whitespaces + ']';\nvar ltrim = RegExp('^' + whitespace + whitespace + '*');\nvar rtrim = RegExp(whitespace + whitespace + '*$');\n\n// `String.prototype.{ trim, trimStart, trimEnd, trimLeft, trimRight }` methods implementation\nvar createMethod = function (TYPE) {\n  return function ($this) {\n    var string = String(requireObjectCoercible($this));\n    if (TYPE & 1) string = string.replace(ltrim, '');\n    if (TYPE & 2) string = string.replace(rtrim, '');\n    return string;\n  };\n};\n\nmodule.exports = {\n  // `String.prototype.{ trimLeft, trimStart }` methods\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trimstart\n  start: createMethod(1),\n  // `String.prototype.{ trimRight, trimEnd }` methods\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trimend\n  end: createMethod(2),\n  // `String.prototype.trim` method\n  // https://tc39.github.io/ecma262/#sec-string.prototype.trim\n  trim: createMethod(3)\n};\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./VideoStream.vue?vue&type=style&index=0&id=5c99097c&lang=scss&scoped=true\"","var requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar quot = /\"/g;\n\n// B.2.3.2.1 CreateHTML(string, tag, attribute, value)\n// https://tc39.github.io/ecma262/#sec-createhtml\nmodule.exports = function (string, tag, attribute, value) {\n  var S = String(requireObjectCoercible(string));\n  var p1 = '<' + tag;\n  if (attribute !== '') p1 += ' ' + attribute + '=\"' + String(value).replace(quot, '&quot;') + '\"';\n  return p1 + '>' + S + '</' + tag + '>';\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar createHTML = require('../internals/create-html');\nvar forcedStringHTMLMethod = require('../internals/string-html-forced');\n\n// `String.prototype.link` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.link\n$({ target: 'String', proto: true, forced: forcedStringHTMLMethod('link') }, {\n  link: function link(url) {\n    return createHTML(this, 'a', 'href', url);\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toInteger = require('../internals/to-integer');\nvar toLength = require('../internals/to-length');\nvar toObject = require('../internals/to-object');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar createProperty = require('../internals/create-property');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\nvar USES_TO_LENGTH = arrayMethodUsesToLength('splice', { ACCESSORS: true, 0: 0, 1: 2 });\n\nvar max = Math.max;\nvar min = Math.min;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n// `Array.prototype.splice` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.splice\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT || !USES_TO_LENGTH }, {\n  splice: function splice(start, deleteCount /* , ...items */) {\n    var O = toObject(this);\n    var len = toLength(O.length);\n    var actualStart = toAbsoluteIndex(start, len);\n    var argumentsLength = arguments.length;\n    var insertCount, actualDeleteCount, A, k, from, to;\n    if (argumentsLength === 0) {\n      insertCount = actualDeleteCount = 0;\n    } else if (argumentsLength === 1) {\n      insertCount = 0;\n      actualDeleteCount = len - actualStart;\n    } else {\n      insertCount = argumentsLength - 2;\n      actualDeleteCount = min(max(toInteger(deleteCount), 0), len - actualStart);\n    }\n    if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n      throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n    }\n    A = arraySpeciesCreate(O, actualDeleteCount);\n    for (k = 0; k < actualDeleteCount; k++) {\n      from = actualStart + k;\n      if (from in O) createProperty(A, k, O[from]);\n    }\n    A.length = actualDeleteCount;\n    if (insertCount < actualDeleteCount) {\n      for (k = actualStart; k < len - actualDeleteCount; k++) {\n        from = k + actualDeleteCount;\n        to = k + insertCount;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n      for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n    } else if (insertCount > actualDeleteCount) {\n      for (k = len - actualDeleteCount; k > actualStart; k--) {\n        from = k + actualDeleteCount - 1;\n        to = k + insertCount - 1;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n    }\n    for (k = 0; k < insertCount; k++) {\n      O[k + actualStart] = arguments[k + 2];\n    }\n    O.length = len - actualDeleteCount + insertCount;\n    return A;\n  }\n});\n","'use strict';\nvar DESCRIPTORS = require('../internals/descriptors');\nvar global = require('../internals/global');\nvar isForced = require('../internals/is-forced');\nvar redefine = require('../internals/redefine');\nvar has = require('../internals/has');\nvar classof = require('../internals/classof-raw');\nvar inheritIfRequired = require('../internals/inherit-if-required');\nvar toPrimitive = require('../internals/to-primitive');\nvar fails = require('../internals/fails');\nvar create = require('../internals/object-create');\nvar getOwnPropertyNames = require('../internals/object-get-own-property-names').f;\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar defineProperty = require('../internals/object-define-property').f;\nvar trim = require('../internals/string-trim').trim;\n\nvar NUMBER = 'Number';\nvar NativeNumber = global[NUMBER];\nvar NumberPrototype = NativeNumber.prototype;\n\n// Opera ~12 has broken Object#toString\nvar BROKEN_CLASSOF = classof(create(NumberPrototype)) == NUMBER;\n\n// `ToNumber` abstract operation\n// https://tc39.github.io/ecma262/#sec-tonumber\nvar toNumber = function (argument) {\n  var it = toPrimitive(argument, false);\n  var first, third, radix, maxCode, digits, length, index, code;\n  if (typeof it == 'string' && it.length > 2) {\n    it = trim(it);\n    first = it.charCodeAt(0);\n    if (first === 43 || first === 45) {\n      third = it.charCodeAt(2);\n      if (third === 88 || third === 120) return NaN; // Number('+0x1') should be NaN, old V8 fix\n    } else if (first === 48) {\n      switch (it.charCodeAt(1)) {\n        case 66: case 98: radix = 2; maxCode = 49; break; // fast equal of /^0b[01]+$/i\n        case 79: case 111: radix = 8; maxCode = 55; break; // fast equal of /^0o[0-7]+$/i\n        default: return +it;\n      }\n      digits = it.slice(2);\n      length = digits.length;\n      for (index = 0; index < length; index++) {\n        code = digits.charCodeAt(index);\n        // parseInt parses a string to a first unavailable symbol\n        // but ToNumber should return NaN if a string contains unavailable symbols\n        if (code < 48 || code > maxCode) return NaN;\n      } return parseInt(digits, radix);\n    }\n  } return +it;\n};\n\n// `Number` constructor\n// https://tc39.github.io/ecma262/#sec-number-constructor\nif (isForced(NUMBER, !NativeNumber(' 0o1') || !NativeNumber('0b1') || NativeNumber('+0x1'))) {\n  var NumberWrapper = function Number(value) {\n    var it = arguments.length < 1 ? 0 : value;\n    var dummy = this;\n    return dummy instanceof NumberWrapper\n      // check on 1..constructor(foo) case\n      && (BROKEN_CLASSOF ? fails(function () { NumberPrototype.valueOf.call(dummy); }) : classof(dummy) != NUMBER)\n        ? inheritIfRequired(new NativeNumber(toNumber(it)), dummy, NumberWrapper) : toNumber(it);\n  };\n  for (var keys = DESCRIPTORS ? getOwnPropertyNames(NativeNumber) : (\n    // ES3:\n    'MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,' +\n    // ES2015 (in case, if modules with ES2015 Number statics required before):\n    'EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,' +\n    'MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,' +\n    // ESNext\n    'fromString,range'\n  ).split(','), j = 0, key; keys.length > j; j++) {\n    if (has(NativeNumber, key = keys[j]) && !has(NumberWrapper, key)) {\n      defineProperty(NumberWrapper, key, getOwnPropertyDescriptor(NativeNumber, key));\n    }\n  }\n  NumberWrapper.prototype = NumberPrototype;\n  NumberPrototype.constructor = NumberWrapper;\n  redefine(global, NUMBER, NumberWrapper);\n}\n","var fails = require('../internals/fails');\n\n// check the existence of a method, lowercase\n// of a tag and escaping quotes in arguments\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    var test = ''[METHOD_NAME]('\"');\n    return test !== test.toLowerCase() || test.split('\"').length > 3;\n  });\n};\n","<template>\n  <div class=\"canvasContainer\">\n    <canvas ref=\"yuvCanvas\"></canvas>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  onMounted,\n  ref,\n  defineComponent,\n  onBeforeUnmount,\n  watchEffect\n} from \"vue\";\nimport { YuvCanvas } from \"webglUtils\";\nimport { Decoder } from \"@/plugins/decoder/decoder\";\nexport default defineComponent({\n  name: \"VideoStream\",\n  props: {\n    wsAddress: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    let yuv: undefined | YuvCanvas;\n    const yuvCanvas = ref(null as null | HTMLCanvasElement);\n    let wsConnection: null | WebSocket;\n    let reconnectId: number;\n    let timeFrame = new Date().getTime();\n    let decoder: null | Decoder;\n    let msgCount = 0;\n    const connectServer = (address: string) => {\n      if (wsConnection) {\n        wsConnection.close();\n        wsConnection = null;\n      }\n      wsConnection = new WebSocket(address);\n      wsConnection.binaryType = \"arraybuffer\";\n      wsConnection.onmessage = (evt: MessageEvent) => {\n        msgCount++;\n        if (evt.data.byteLength) {\n          decoder\n            ?.decode({ buffer: evt.data, offset: 0 })\n            .then(frame => {\n              timeFrame = new Date().getTime();\n              if (yuv) yuv.drawFrame(frame);\n            })\n            .catch(() => {\n              // do nothing\n            });\n        }\n      };\n    };\n    watchEffect(() => {\n      connectServer(props.wsAddress);\n    });\n    onMounted(() => {\n      if (yuvCanvas.value) yuv = new YuvCanvas(yuvCanvas.value);\n      decoder = new Decoder();\n      connectServer(props.wsAddress);\n      reconnectId = window.setInterval(() => {\n        const now = new Date().getTime();\n        if (now - timeFrame > 5000) {\n          timeFrame = now;\n          connectServer(props.wsAddress);\n        } else {\n          if (wsConnection && wsConnection.readyState === 1) {\n            const countArray = new Int32Array(1);\n            countArray[0] = msgCount;\n            wsConnection.send(countArray.buffer);\n          }\n        }\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      window.clearInterval(reconnectId);\n      wsConnection?.close();\n      decoder?.terminate();\n    });\n    return { yuvCanvas };\n  }\n});\n</script>\n\n<style lang=\"scss\" scoped>\ncanvas {\n  height: 100%;\n  width: 100%;\n}\n.canvasContainer {\n  height: 100%;\n  width: 100%;\n  background-color: transparent;\n  padding: 0;\n  line-height: 0;\n}\n</style>\n","\nimport {\n  onMounted,\n  ref,\n  defineComponent,\n  onBeforeUnmount,\n  watchEffect\n} from \"vue\";\nimport { YuvCanvas } from \"webglUtils\";\nimport { Decoder } from \"@/plugins/decoder/decoder\";\nexport default defineComponent({\n  name: \"VideoStream\",\n  props: {\n    wsAddress: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    let yuv: undefined | YuvCanvas;\n    const yuvCanvas = ref(null as null | HTMLCanvasElement);\n    let wsConnection: null | WebSocket;\n    let reconnectId: number;\n    let timeFrame = new Date().getTime();\n    let decoder: null | Decoder;\n    let msgCount = 0;\n    const connectServer = (address: string) => {\n      if (wsConnection) {\n        wsConnection.close();\n        wsConnection = null;\n      }\n      wsConnection = new WebSocket(address);\n      wsConnection.binaryType = \"arraybuffer\";\n      wsConnection.onmessage = (evt: MessageEvent) => {\n        msgCount++;\n        if (evt.data.byteLength) {\n          decoder\n            ?.decode({ buffer: evt.data, offset: 0 })\n            .then(frame => {\n              timeFrame = new Date().getTime();\n              if (yuv) yuv.drawFrame(frame);\n            })\n            .catch(() => {\n              // do nothing\n            });\n        }\n      };\n    };\n    watchEffect(() => {\n      connectServer(props.wsAddress);\n    });\n    onMounted(() => {\n      if (yuvCanvas.value) yuv = new YuvCanvas(yuvCanvas.value);\n      decoder = new Decoder();\n      connectServer(props.wsAddress);\n      reconnectId = window.setInterval(() => {\n        const now = new Date().getTime();\n        if (now - timeFrame > 5000) {\n          timeFrame = now;\n          connectServer(props.wsAddress);\n        } else {\n          if (wsConnection && wsConnection.readyState === 1) {\n            const countArray = new Int32Array(1);\n            countArray[0] = msgCount;\n            wsConnection.send(countArray.buffer);\n          }\n        }\n      }, 500);\n    });\n    onBeforeUnmount(() => {\n      window.clearInterval(reconnectId);\n      wsConnection?.close();\n      decoder?.terminate();\n    });\n    return { yuvCanvas };\n  }\n});\n","import { render } from \"./VideoStream.vue?vue&type=template&id=5c99097c&scoped=true\"\nimport script from \"./VideoStream.vue?vue&type=script&lang=ts\"\nexport * from \"./VideoStream.vue?vue&type=script&lang=ts\"\n\nimport \"./VideoStream.vue?vue&type=style&index=0&id=5c99097c&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5c99097c\"\n\nexport default script","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"js/decoder.worker.bfb36e41.worker.js\");\n}\n","import Worker from \"./decoder.worker\";\n\nexport class Decoder {\n  constructor() {\n    this.renderStateId = \"render\" + new Date().getTime();\n    this.worker = Worker();\n    this.workerReady = false;\n    this.decodeBuffer = [];\n    (this.codec = 264),\n      this.worker.addEventListener(\"message\", e => {\n        const message = e.data;\n        switch (message.type) {\n          case \"success\":\n            this.decodeBuffer.shift().resolve(message);\n            break;\n          case \"error\":\n            this.decodeBuffer.shift().reject(\"invalid_frame\");\n            break;\n          case \"ready\":\n            this.workerReady = true;\n            break;\n          default:\n            break;\n        }\n      });\n  }\n  terminate() {\n    this.worker.terminate();\n  }\n  setCodec(codec) {\n    this.codec = codec;\n  }\n  decode(data) {\n    if (this.workerReady) {\n      this.worker.postMessage(\n        {\n          type: \"decode\",\n          data: data.buffer,\n          offset: data.offset,\n          codec: this.codec,\n          renderStateId: this.renderStateId\n        },\n        [data.buffer]\n      );\n      return new Promise((resolve, reject) => {\n        this.decodeBuffer.push({ resolve, reject });\n      });\n    } else {\n      return new Promise((resolve, reject) => {\n        reject(\"loading...\");\n      });\n    }\n  }\n}\n","'use strict';\nvar $ = require('../internals/export');\nvar $findIndex = require('../internals/array-iteration').findIndex;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar FIND_INDEX = 'findIndex';\nvar SKIPS_HOLES = true;\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength(FIND_INDEX);\n\n// Shouldn't skip holes\nif (FIND_INDEX in []) Array(1)[FIND_INDEX](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.findIndex` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.findindex\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $findIndex(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND_INDEX);\n","var createTypedArrayConstructor = require('../internals/typed-array-constructor');\n\n// `Float32Array` constructor\n// https://tc39.github.io/ecma262/#sec-typedarray-objects\ncreateTypedArrayConstructor('Float32', function (init) {\n  return function Float32Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n","export default class ShaderProgram {\n    constructor(gl) {\n        this.gl = gl;\n        this.program = this.gl.createProgram();\n    }\n    attach(shader) {\n        this.gl.attachShader(this.program, shader);\n    }\n    link() {\n        this.gl.linkProgram(this.program);\n        if (!this.gl.getProgramParameter(this.program, this.gl.LINK_STATUS)) {\n            console.error('Unable to initialize the shader program.');\n        }\n    }\n    use() {\n        this.gl.useProgram(this.program);\n    }\n    getAttributeLocation(name) {\n        return this.gl.getAttribLocation(this.program, name);\n    }\n    getUniformLocation(name) {\n        return this.gl.getUniformLocation(this.program, name);\n    }\n    setUniformM4(uniformLocation, array) {\n        this.gl.uniformMatrix4fv(uniformLocation, false, array);\n    }\n}\n//# sourceMappingURL=ShaderProgram.js.map","export default class ShaderCompiler {\n    static compile(gl, script) {\n        let shader;\n        // Now figure out what type of shader script we have, based on its MIME type.\n        if (script.type === 'x-shader/x-fragment') {\n            shader = gl.createShader(gl.FRAGMENT_SHADER);\n        }\n        else if (script.type === 'x-shader/x-vertex') {\n            shader = gl.createShader(gl.VERTEX_SHADER);\n        }\n        else {\n            throw new Error('Unknown shader type: ' + script.type);\n        }\n        // Send the source to the shader object.\n        gl.shaderSource(shader, script.source);\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            throw new Error('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader));\n        }\n        return shader;\n    }\n}\n//# sourceMappingURL=ShaderCompiler.js.map","export const vertexQuad = {\n    type: 'x-shader/x-vertex',\n    source: `\n    precision mediump float;\n  \n    uniform mat4 u_projection;\n    attribute vec2 a_position;\n    attribute vec2 a_texCoord;\n    varying vec2 v_texCoord;\n    void main(){\n        v_texCoord = a_texCoord;\n        gl_Position = u_projection * vec4(a_position, 0.0, 1.0);\n    }\n  `\n};\nexport const fragmentYUV = {\n    type: 'x-shader/x-fragment',\n    source: `\n    precision lowp float;\n    \n    varying vec2 v_texCoord;\n    \n    uniform sampler2D yTexture;\n    uniform sampler2D uTexture;\n    uniform sampler2D vTexture;\n      \n    const mat4 conversion = mat4(\n      1.0,     0.0,     1.402,  -0.701,\n      1.0,    -0.344,  -0.714,   0.529,\n      1.0,     1.772,   0.0,    -0.886,\n      0.0,     0.0,     0.0,     0.0\n    );\n  \n    void main(void) {\n      float yChannel = texture2D(yTexture, v_texCoord).x;\n      float uChannel = texture2D(uTexture, v_texCoord).x;\n      float vChannel = texture2D(vTexture, v_texCoord).x;\n      vec4 channels = vec4(yChannel, uChannel, vChannel, 1.0);\n      vec3 rgb = (channels * conversion).xyz;\n      gl_FragColor = vec4(rgb, 1.0);\n    }\n  `\n};\n//# sourceMappingURL=ShaderSources.js.map","import ShaderProgram from './ShaderProgram';\nimport ShaderCompiler from './ShaderCompiler';\nimport { fragmentYUV, vertexQuad } from './ShaderSources';\nexport default class YUVSurfaceShader {\n    constructor(gl, vertexBuffer, shaderArgs, program) {\n        this.gl = gl;\n        this.vertexBuffer = vertexBuffer;\n        this.shaderArgs = shaderArgs;\n        this.program = program;\n    }\n    static create(gl) {\n        const program = this._initShaders(gl);\n        const shaderArgs = this._initShaderArgs(gl, program);\n        const vertexBuffer = this._initBuffers(gl);\n        return new YUVSurfaceShader(gl, vertexBuffer, shaderArgs, program);\n    }\n    static _initShaders(gl) {\n        const program = new ShaderProgram(gl);\n        program.attach(ShaderCompiler.compile(gl, vertexQuad));\n        program.attach(ShaderCompiler.compile(gl, fragmentYUV));\n        program.link();\n        program.use();\n        return program;\n    }\n    static _initShaderArgs(gl, program) {\n        // find shader arguments\n        const yTexture = program.getUniformLocation('yTexture');\n        const uTexture = program.getUniformLocation('uTexture');\n        const vTexture = program.getUniformLocation('vTexture');\n        const u_projection = program.getUniformLocation('u_projection');\n        const a_position = program.getAttributeLocation('a_position');\n        gl.enableVertexAttribArray(a_position);\n        const a_texCoord = program.getAttributeLocation('a_texCoord');\n        gl.enableVertexAttribArray(a_texCoord);\n        return { yTexture, uTexture, vTexture, u_projection, a_position, a_texCoord };\n    }\n    static _initBuffers(gl) {\n        return gl.createBuffer();\n    }\n    setTexture(textureY, textureU, textureV) {\n        const gl = this.gl;\n        gl.uniform1i(this.shaderArgs.yTexture, 0);\n        gl.uniform1i(this.shaderArgs.uTexture, 1);\n        gl.uniform1i(this.shaderArgs.vTexture, 2);\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, textureY.texture);\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, textureU.texture);\n        gl.activeTexture(gl.TEXTURE2);\n        gl.bindTexture(gl.TEXTURE_2D, textureV.texture);\n    }\n    use() {\n        this.program.use();\n    }\n    release() {\n        const gl = this.gl;\n        gl.useProgram(null);\n    }\n    updateShaderData(encodedFrameSize, h264RenderState) {\n        const { w, h } = encodedFrameSize;\n        this.gl.viewport(0, 0, w, h);\n        this.program.setUniformM4(this.shaderArgs.u_projection, [\n            2.0 / w, 0, 0, 0,\n            0, 2.0 / -h, 0, 0,\n            0, 0, 1, 0,\n            -1, 1, 0, 1\n        ]);\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vertexBuffer);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array([\n            // First triangle\n            // top left:\n            0, 0, 0, 0,\n            // top right:\n            w, 0, h264RenderState.maxXTexCoord, 0,\n            // bottom right:\n            w, h, h264RenderState.maxXTexCoord, h264RenderState.maxYTexCoord,\n            // Second triangle\n            // bottom right:\n            w, h, h264RenderState.maxXTexCoord, h264RenderState.maxYTexCoord,\n            // bottom left:\n            0, h, 0, h264RenderState.maxYTexCoord,\n            // top left:\n            0, 0, 0, 0\n        ]), this.gl.DYNAMIC_DRAW);\n        this.gl.vertexAttribPointer(this.shaderArgs.a_position, 2, this.gl.FLOAT, false, 16, 0);\n        this.gl.vertexAttribPointer(this.shaderArgs.a_texCoord, 2, this.gl.FLOAT, false, 16, 8);\n    }\n    draw() {\n        const gl = this.gl;\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT);\n        gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 6);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n}\n//# sourceMappingURL=YUVSurfaceShader.js.map","export default class Texture {\n    constructor(gl, format, texture) {\n        this.gl = gl;\n        this.texture = texture;\n        this.format = format;\n    }\n    static create(gl, format) {\n        const texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return new Texture(gl, format, texture);\n    }\n    subImage2dBuffer(buffer, x, y, width, height) {\n        const gl = this.gl;\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, width, height, this.format, gl.UNSIGNED_BYTE, buffer);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n    image2dBuffer(buffer, width, height) {\n        const gl = this.gl;\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, gl.UNSIGNED_BYTE, buffer);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n    delete() {\n        this.gl.deleteTexture(this.texture);\n        this.texture = null;\n    }\n}\n//# sourceMappingURL=Texture.js.map","import YUVSurfaceShader from './YUVSurfaceShader';\nimport Texture from './Texture';\nclass YuvCanvas {\n    constructor(canvas) {\n        this.canvas = canvas;\n        this.gl = canvas.getContext('webgl');\n        this.yuvSurfaceShader = YUVSurfaceShader.create(this.gl);\n        this.yTexture = Texture.create(this.gl, this.gl.LUMINANCE);\n        this.uTexture = Texture.create(this.gl, this.gl.LUMINANCE);\n        this.vTexture = Texture.create(this.gl, this.gl.LUMINANCE);\n    }\n    drawFrame(message) {\n        const { width, height, data } = message;\n        this.canvas.width = width;\n        this.canvas.height = height;\n        const buffer = new Uint8Array(data);\n        const stride = width; // stride\n        const sourceWidth = width;\n        const sourceHeight = height;\n        const maxXTexCoord = sourceWidth / stride;\n        const maxYTexCoord = sourceHeight / height;\n        const lumaSize = stride * height;\n        const chromaSize = lumaSize >> 2;\n        const yBuffer = buffer.subarray(0, lumaSize);\n        const uBuffer = buffer.subarray(lumaSize, lumaSize + chromaSize);\n        const vBuffer = buffer.subarray(lumaSize + chromaSize, lumaSize + (2 * chromaSize));\n        const chromaHeight = height >> 1;\n        const chromaStride = stride >> 1;\n        this.yTexture.image2dBuffer(yBuffer, stride, height);\n        this.uTexture.image2dBuffer(uBuffer, chromaStride, chromaHeight);\n        this.vTexture.image2dBuffer(vBuffer, chromaStride, chromaHeight);\n        this.yuvSurfaceShader.setTexture(this.yTexture, this.uTexture, this.vTexture);\n        this.yuvSurfaceShader.updateShaderData({ w: width, h: height }, { maxXTexCoord, maxYTexCoord });\n        this.yuvSurfaceShader.draw();\n    }\n}\nexport default YuvCanvas;\n//# sourceMappingURL=YuvCanvas.js.map"],"sourceRoot":""}